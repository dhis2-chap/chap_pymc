name: hmc_model

meta_data:
  author: Knut Rand
  author_note: >
      This model is currently quite uncertain when predicting from the end of one season to the beginning of another. It can give very high max estimates for the upper quantiles.
  author_assessed_status: red
  contact_email: knutdrand@gmail.com
  description: >
    This model is a HMC based adaption of inla models that allows for predicting without knowing future covariates. It does a more detailed curve fitting.
    INLA models typically uses seasonal_effect + yearly_random_effect. While this model does the curve fitting using four fourier components
  display_name: HMC Model
  organization: HISP Centre, University of Oslo
  organization_logo_url: https://landportal.org/sites/default/files/2024-03/university_of_oslo_logo.png
  citation_info: >
    Climate Health Analytics Platform. 2025. "Torch Deep Learning Model".
    HISP Centre, University of Oslo.
    https://dhis2-chap.github.io/chap-core/external_models/overview_of_supported_models.html

allow_free_additional_continuous_covariates: true
required_covariates:
- mean_temperature
supported_period_type: any
target: disease_cases
user_options:
  # Inference parameters (InferenceParams)
  method:
    default: hmc
    title: Inference Method
    type: string
    enum: [hmc, advi]
  draws:
    default: 500
    title: Number of Draws (HMC)
    type: integer
  tune:
    default: 500
    title: Number of Tuning Steps (HMC)
    type: integer
  chains:
    default: 4
    title: Number of Chains (HMC)
    type: integer
  target_accept:
    default: 0.95
    title: Target Acceptance Rate (HMC)
    type: number
  n_iterations:
    default: 200000
    title: Number of Iterations (ADVI)
    type: integer
  n_samples:
    default: 500
    title: Number of Samples (ADVI)
    type: integer
  random_seed:
    default: 42
    title: Random Seed
    type: integer
  # Fourier hyperparameters (FourierHyperparameters)
  n_harmonics:
    default: 3
    title: Number of Fourier Harmonics
    type: integer
  do_ar_effect:
    default: false
    title: Use Autoregressive Effect
    type: boolean
  do_mixture:
    default: false
    title: Use Mixture Model
    type: boolean
  use_prev_year:
    default: true
    title: Use Previous Year Data
    type: boolean
  prior_strength:
    default: 1.0
    title: Prior Strength (Scale Factor)
    type: number
  # Input creator parameters (FourierInputCreator.Params)
  lag:
    default: 3
    title: Number of Lag Features
    type: integer
  skip_bottom_n_seasons:
      default: 0
    title: Number of Lowest Seasons to Skip
    type: integer

entry_points:
  train:
    command: python main.py train {train_data} {model} {model_config}
    parameters:
      train_data: str
      model: str
      model_config: str
  predict:
    command: python main.py predict {model} {historic_data} {future_data} {out_file}
      {model_config} {report_filename}
    parameters:
      model: str
      historic_data: str
      future_data: str
      out_file: str
      model_config: str

python_env: pyenv.yaml